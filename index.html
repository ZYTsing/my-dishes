<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä»Šæ™šæˆ‘ä¸‹å¨ - æœ‹å‹ä¸“å±Â·é¢„çº¦åˆ¶ç§æˆ¿èœ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: 'Noto Serif SC', serif;
            background: linear-gradient(135deg, #fef9f3 0%, #fdf4e8 100%);
            min-height: 100vh;
        }
        .wood-texture {
            background: linear-gradient(180deg, #d4a574 0%, #c49a6c 100%);
        }
        .card-shadow {
            box-shadow: 0 4px 20px rgba(212, 165, 116, 0.15);
        }
        .selected-card {
            border: 3px solid #f97316 !important;
            transform: scale(1.02);
        }
        .blind-box-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
        }
        .category-nav {
            backdrop-filter: blur(10px);
            background: rgba(254, 249, 243, 0.95);
        }
        .dish-image {
            transition: transform 0.3s ease;
        }
        .dish-card:hover .dish-image {
            transform: scale(1.05);
        }
        .check-mark {
            animation: popIn 0.3s ease;
        }
        @keyframes popIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .modal-enter {
            animation: modalSlideUp 0.3s ease;
        }
        @keyframes modalSlideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .ingredient-tag {
            background: linear-gradient(135deg, #fef3e2 0%, #fde8c8 100%);
        }
        .send-btn {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }
        .send-btn:active {
            transform: scale(0.98);
        }
        .quantity-badge {
            animation: bounce 0.5s ease;
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #fef9f3;
        }
        ::-webkit-scrollbar-thumb {
            background: #d4a574;
            border-radius: 3px;
        }
    </style>
</head>
<body class="pb-24">
    <!-- é¡¶éƒ¨æ ‡é¢˜åŒº -->
    <header class="wood-texture text-white py-6 px-4 text-center relative overflow-hidden">
        <div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px);"></div>
        <h1 class="text-3xl font-bold mb-1 relative z-10">ä»Šæ™šæˆ‘ä¸‹å¨</h1>
        <p class="text-sm opacity-90 relative z-10">æœ‹å‹ä¸“å± Â· é¢„çº¦åˆ¶ç§æˆ¿èœ</p>
    </header>

    <!-- åˆ†ç±»å¯¼èˆª -->
    <nav class="category-nav sticky top-0 z-40 border-b border-orange-200">
        <div class="flex justify-around py-3 px-2">
            <button onclick="scrollToCategory('hot')" class="category-btn px-4 py-2 rounded-full text-sm font-medium transition-all bg-orange-500 text-white" data-category="hot">
                çƒ­èœ
            </button>
            <button onclick="scrollToCategory('soup')" class="category-btn px-4 py-2 rounded-full text-sm font-medium transition-all text-orange-700 hover:bg-orange-100" data-category="soup">
                æ±¤
            </button>
            <button onclick="scrollToCategory('staple')" class="category-btn px-4 py-2 rounded-full text-sm font-medium transition-all text-orange-700 hover:bg-orange-100" data-category="staple">
                ä¸»é£Ÿ
            </button>
            <button onclick="scrollToCategory('cold')" class="category-btn px-4 py-2 rounded-full text-sm font-medium transition-all text-orange-700 hover:bg-orange-100" data-category="cold">
                å‡‰èœ
            </button>
        </div>
    </nav>

    <!-- èœå“åˆ—è¡¨åŒº -->
    <main class="px-4 py-4 space-y-6">
        <!-- çƒ­èœåˆ†ç±» -->
        <section id="hot" class="category-section">
            <h2 class="text-xl font-bold text-orange-800 mb-3 flex items-center">
                <span class="w-1 h-6 bg-orange-500 rounded-full mr-2"></span>
                çƒ­èœ
                <span class="ml-2 text-sm font-normal text-orange-600">Hot Dishes</span>
            </h2>
            <div class="grid grid-cols-1 gap-4" id="hot-dishes"></div>
        </section>

        <!-- æ±¤åˆ†ç±» -->
        <section id="soup" class="category-section">
            <h2 class="text-xl font-bold text-orange-800 mb-3 flex items-center">
                <span class="w-1 h-6 bg-orange-500 rounded-full mr-2"></span>
                æ±¤
                <span class="ml-2 text-sm font-normal text-orange-600">Soup</span>
            </h2>
            <div class="grid grid-cols-1 gap-4" id="soup-dishes"></div>
        </section>

        <!-- ä¸»é£Ÿåˆ†ç±» -->
        <section id="staple" class="category-section">
            <h2 class="text-xl font-bold text-orange-800 mb-3 flex items-center">
                <span class="w-1 h-6 bg-orange-500 rounded-full mr-2"></span>
                ä¸»é£Ÿ
                <span class="ml-2 text-sm font-normal text-orange-600">Staple</span>
            </h2>
            <div class="grid grid-cols-1 gap-4" id="staple-dishes"></div>
        </section>

        <!-- å‡‰èœåˆ†ç±» -->
        <section id="cold" class="category-section">
            <h2 class="text-xl font-bold text-orange-800 mb-3 flex items-center">
                <span class="w-1 h-6 bg-orange-500 rounded-full mr-2"></span>
                å‡‰èœ
                <span class="ml-2 text-sm font-normal text-orange-600">Cold Dishes</span>
            </h2>
            <div class="grid grid-cols-1 gap-4" id="cold-dishes"></div>
        </section>
    </main>

    <!-- åº•éƒ¨ç»“ç®—æ  -->
    <footer class="fixed bottom-0 left-0 right-0 bg-white border-t border-orange-200 px-4 py-3 z-50 card-shadow">
        <div class="flex items-center justify-between max-w-lg mx-auto">
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                    </div>
                    <span id="selected-count" class="quantity-badge absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hidden">0</span>
                </div>
                <div>
                    <p class="text-sm text-gray-600">å·²é€‰ <span id="count-text" class="font-bold text-orange-600">0</span> é“èœ</p>
                    <p class="text-xs text-gray-500">é¢„è®¡ç”¨æ—¶ <span id="total-time" class="font-bold text-orange-600">0</span> åˆ†é’Ÿ</p>
                </div>
            </div>
            <button onclick="openModal()" class="send-btn text-white px-6 py-3 rounded-full font-medium text-sm shadow-lg">
                æŸ¥çœ‹å¤‡èœæ¸…å•
            </button>
        </div>
    </footer>

    <!-- å¤‡èœæ¸…å•æ¨¡æ€æ¡† -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-end sm:items-center justify-center">
        <div class="bg-white w-full max-w-lg max-h-[85vh] rounded-t-3xl sm:rounded-3xl modal-enter flex flex-col">
            <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
            <div class="flex items-center justify-between p-4 border-b border-orange-100">
                <h3 class="text-lg font-bold text-orange-800">å¤‡èœæ¸…å•</h3>
                <button onclick="closeModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-orange-100">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- æ¨¡æ€æ¡†å†…å®¹ -->
            <div class="flex-1 overflow-y-auto p-4">
                <!-- å·²é€‰èœå“ -->
                <div class="mb-6">
                    <h4 class="text-sm font-bold text-gray-700 mb-2 flex items-center">
                        <svg class="w-4 h-4 mr-1 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        å·²é€‰èœå“
                    </h4>
                    <div id="modal-dishes-list" class="space-y-2"></div>
                </div>

                <!-- å¤‡æ–™æ±‡æ€» -->
                <div class="mb-6">
                    <h4 class="text-sm font-bold text-gray-700 mb-2 flex items-center">
                        <svg class="w-4 h-4 mr-1 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        å¤‡æ–™æ±‡æ€»
                    </h4>
                    <div id="modal-ingredients-list" class="flex flex-wrap gap-2"></div>
                </div>

                <!-- æ—¶é—´ç»Ÿè®¡ -->
                <div class="bg-orange-50 rounded-xl p-4 mb-4">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">é¢„è®¡æ€»ç”¨æ—¶</span>
                        <span class="text-xl font-bold text-orange-600"><span id="modal-total-time">0</span> åˆ†é’Ÿ</span>
                    </div>
                </div>
            </div>

            <!-- æ¨¡æ€æ¡†åº•éƒ¨ -->
            <div class="p-4 border-t border-orange-100 bg-white">
                <button onclick="sendEmail()" id="send-btn" class="send-btn w-full text-white py-4 rounded-xl font-medium text-base shadow-lg flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    å‘é€å¤‡èœæ¸…å•
                </button>
            </div>
        </div>
    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div id="toast" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gray-800 text-white px-6 py-3 rounded-xl shadow-lg z-50 hidden">
        <span id="toast-message"></span>
    </div>

    <script>
        // èœå“æ•°æ®
        const dishesData = [
            // çƒ­èœ
            { id: 1, category: 'hot', name: 'ç™½ç¼å¤§è™¾é…æ³°å¼è˜¸æ–™', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/ç™½ç¼å¤§è™¾é…æ³°å¼è˜¸æ–™.jpg', time: 20, ingredients: 'è™¾500gã€è’œ4ç“£ã€ç™½ç ‚ç³–10gã€å°ç±³è¾£2ä¸ªã€é¦™èœ2é¢—ã€é’æŸ æª¬0.5ä¸ªã€é±¼éœ²10gã€æ¤°å­æ°´1ç“¶', tag: '' },
            { id: 2, category: 'hot', name: 'æ¿æ —ç„–é¸¡', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/æ¿æ —ç„–é¸¡.jpg', time: 90, ingredients: 'æ¿æ —200gã€é¸¡è‚‰500gã€å†°ç³–10gã€å§œ1ä¸ªã€é¦™å¶1ç‰‡ã€å…«è§’1ä¸ªã€å¤§è‘±1èŠ‚ã€å¹²è¾£æ¤’2ä¸ª', tag: '' },
            { id: 3, category: 'hot', name: 'è¶…ç»è‚‰èŸ¹ç…²', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/è¶…ç»è‚‰èŸ¹ç…².jpg', time: 120, ingredients: 'è‚‰èŸ¹500gã€é¸¡è„š300gã€è™¾300gã€å§œ1ä¸ªã€å†°ç³–10gã€è’œ8ç“£ã€å¹²è¾£æ¤’5ä¸ªã€èŠ±æ¤’10é¢—ã€åœŸè±†200gã€å¹´ç³•200g', tag: '' },
            { id: 4, category: 'hot', name: 'æ»‘è›‹è™¾ä»', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/æ»‘è›‹è™¾ä».jpg', time: 20, ingredients: 'è™¾ä»200gã€é¸¡è›‹4ä¸ª', tag: '' },
            { id: 5, category: 'hot', name: 'é’èŠ±æ¤’é¸¡ç¿…ä¸­', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/é’èŠ±æ¤’é¸¡ç¿…ä¸­.jpg', time: 35, ingredients: 'é¸¡ç¿…ä¸­500gã€é’èŠ±æ¤’50gã€è’œ4ç“£ã€å°ç±³è¾£3ä¸ªã€çº¿æ¤’2ä¸ªã€å§œ0.5ä¸ª', tag: '' },
            { id: 6, category: 'hot', name: 'ä¸‰æ¯é¸¡', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/ä¸‰æ¯é¸¡.jpg', time: 35, ingredients: 'é¸¡è…¿è‚‰500gã€å§œ1ä¸ªã€è’œ6ç“£ã€å°ç±³è¾£3ä¸ªã€å†°ç³–10g', tag: '' },
            { id: 7, category: 'hot', name: 'æ¨Ÿæ ‘æ¸¯çƒ§æ¤’æ’éª¨', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/æ¨Ÿæ ‘æ¸¯çƒ§æ¤’æ’éª¨.jpg', time: 40, ingredients: 'æ’éª¨500gã€æ¨Ÿæ ‘æ¸¯è¾£æ¤’200gã€å°ç±³è¾£3ä¸ªã€è’œ6ç“£ã€å•¤é…’1ç½', tag: '' },
            { id: 8, category: 'hot', name: 'èŠå£«é²ˆé±¼èŠ±ç”²', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/èŠå£«é²ˆé±¼èŠ±ç”².jpg', time: 40, ingredients: 'é²ˆé±¼ç‰‡200gã€èŠ±ç”²200gã€å°ç•ªèŒ„200gã€é»„æ²¹20gã€å¸•ç›æ£®èŠå£«20gã€é±¼éª¨200gã€æŸ æª¬å¶1ç‰‡ã€è’œ4ç“£', tag: '' },
            { id: 9, category: 'hot', name: 'ç´«è‹æŸ æª¬é¸­', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/ç´«è‹æŸ æª¬é¸­.jpg', time: 60, ingredients: 'é»„æŸ æª¬1ä¸ªã€æ³¡æ¤’3ä¸ªã€å§œ1ä¸ªã€é¸­500gã€å•¤é…’1ç½ã€ç´«è‹10g', tag: '' },
            { id: 10, category: 'hot', name: 'é’æ¤’è™¾æ»‘', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/é’æ¤’è™¾æ»‘.jpg', time: 15, ingredients: 'è™¾æ»‘240gã€é’æ¤’200gã€è’œ4ç“£', tag: '' },
            { id: 11, category: 'hot', name: 'æ¸…ç‚’æ—¶è”¬', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/æ¸…ç‚’æ—¶è”¬.jpg', time: 10, ingredients: 'è”¬èœ500gã€è’œ2ç“£ã€å°ç±³è¾£1ä¸ª', tag: '' },
            { id: 12, category: 'hot', name: 'âœ¨å¨æˆ¿é¦–ç§€ï¼ˆä»Šæ—¥ç›²ç›’ï¼‰', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/é’èŠ±æ¤’é¸¡ç¿…ä¸­.jpg', time: 45, ingredients: 'å¨å¸ˆç°åœºå‘æŒ¥ï¼Œé£Ÿæä¿å¯†ï¼Œå¼€é¤æœ‰æƒŠå–œï¼', tag: 'ğŸ†•æ–°å°è¯•' },
            // æ±¤
            { id: 13, category: 'soup', name: 'èŠ±èƒ¶é¸¡æ±¤', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/èŠ±èƒ¶é¸¡æ±¤.jpg', time: 30, ingredients: 'ç›’é©¬èŠ±èƒ¶é¸¡1ç›’', tag: '' },
            { id: 14, category: 'soup', name: 'èåœç¾Šè‚‰æ±¤', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/èåœç¾Šè‚‰æ±¤.jpg', time: 120, ingredients: 'ç™½èåœ1ä¸ªã€ç¾Šè‚‰500gã€å§œ1ä¸ªã€å¤§è‘±1èŠ‚ã€èŠ±æ¤’50gã€é»‘èƒ¡æ¤’ç²’10gã€ç™½èƒ¡æ¤’ç²’10gã€é¦™å¶2ç‰‡', tag: '' },
            { id: 15, category: 'soup', name: 'å±±è¯ä¹Œé¸¡æ±¤', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/å±±è¯ä¹Œé¸¡æ±¤.jpg', time: 60, ingredients: 'ä¹Œé¸¡500gã€çº¢æ£3ä¸ªã€æ¸æ10gã€è²å­6ä¸ªã€å±±è¯1æ ¹ã€è™«è‰èŠ±50gã€å§œ1ä¸ª', tag: '' },
            { id: 16, category: 'soup', name: 'å±±è¯ç¾Šè‚‰æ±¤', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/å±±è¯ç¾Šè‚‰æ±¤.jpg', time: 90, ingredients: 'ç¾Šè‚‰500gã€å±±è¯1æ ¹ã€å§œ1ä¸ªã€å¤§è‘±1èŠ‚ã€å½“å½’5gã€å…šå‚5gã€é»„èŠª5gã€çº¢æ£3ä¸ªã€æ¸æ10g', tag: '' },
            { id: 17, category: 'soup', name: 'å±±è¯çŒªéª¨æ±¤', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/å±±è¯çŒªéª¨æ±¤.jpg', time: 90, ingredients: 'æ’éª¨500gã€å±±è¯1æ ¹ã€å§œ1ä¸ªã€å¤§è‘±1èŠ‚ã€è²å­10gã€æ¸æ10g', tag: '' },
            { id: 18, category: 'soup', name: 'çƒ§æ¤’é”…', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/çƒ§æ¤’é”….jpg', time: 90, ingredients: 'äºŒè†æ¡400gã€èºä¸æ¤’100gã€èœæ¤’150gã€å°ç±³è¾£6ä¸ªã€å¤§è’œ10ç“£ã€å§œ1ä¸ªã€è¥¿çº¢æŸ¿300gã€é’èŠ±æ¤’20gã€ç‰›è‚‰300g', tag: '' },
            { id: 19, category: 'soup', name: 'é…¸æ±¤çŒªè„šç…²', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/é…¸æ±¤çŒªè„šç…².jpg', time: 90, ingredients: 'çŒªè„š500gã€å¤§è‘±1èŠ‚ã€ç•ªèŒ„é…±10gã€ç•ªèŒ„400gã€å…«è§’1ä¸ªã€é¦™å¶1ç‰‡ã€å¹²è¾£æ¤’3ä¸ªã€æ³¡æ¤’2ä¸ªã€å§œ1ä¸ªã€å•¤é…’1ç½', tag: '' },
            { id: 20, category: 'soup', name: 'åœŸè±†ç‰›è…©ç…²', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/åœŸè±†ç‰›è…©ç…².jpg', time: 90, ingredients: 'ç‰›è…©500gã€ç•ªèŒ„200gã€åœŸè±†200gã€èƒ¡èåœ1æ ¹ã€å…«è§’1ä¸ªã€å¹²è¾£æ¤’3ä¸ªã€å§œ1ä¸ªã€å¤§è‘±1èŠ‚ã€å†°ç³–10g', tag: '' },
            { id: 21, category: 'soup', name: 'æ¸…ç‚–æ—¶è”¬', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/æ¸…ç‚–æ—¶è”¬.png', time: 10, ingredients: 'è”¬èœ500g', tag: '' },
            { id: 22, category: 'soup', name: 'ğŸ²å¤´é“æ±¤ï¼ˆæ–°å“è¯•åšï¼‰', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/èŠ±èƒ¶é¸¡æ±¤.jpg', time: 60, ingredients: 'é¦–æ¬¡å°è¯•ç…²æ±¤ï¼Œé£Ÿææ–°é²œæ­é…ï¼Œæ•¬è¯·æœŸå¾…å£å‘³', tag: 'ğŸ†•æ–°å°è¯•' },
            // ä¸»é£Ÿ
            { id: 23, category: 'staple', name: 'è²è—•çŒªè‚‰é¥ºå­', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/è²è—•çŒªè‚‰é¥ºå­.jpg', time: 15, ingredients: 'é¥ºå­10ä¸ªã€é¦™èœ2é¢—ã€å°ç±³è¾£3ä¸ª', tag: '' },
            { id: 24, category: 'staple', name: 'èŸ¹æŸ³ç‰›è‚‰æ±¤é¢', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/èŸ¹æŸ³ç‰›è‚‰æ±¤é¢.jpg', time: 15, ingredients: 'èŸ¹æŸ³200gã€æœ´æœ´è¶…å¸‚å°å¼çº¢çƒ§ç‰›è‚‰é¢1è¢‹', tag: '' },
            { id: 25, category: 'staple', name: 'æ–°åŠ å¡å»æ²™æµ·é²œç‰›è‚‰ä¸¸é¢', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/æ–°åŠ å¡å»æ²™æµ·é²œç‰›è‚‰ä¸¸é¢.jpg', time: 30, ingredients: 'ç›’é©¬æ–°åŠ å¡å»æ²™æµ·é²œé¢1ç›’ã€ç‰›è‚‰ä¸¸4ä¸ª', tag: '' },
            { id: 26, category: 'staple', name: 'ğŸœä¸»é£Ÿæ–°èŠ±æ ·ï¼ˆå®éªŒæ¬¾ï¼‰', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/èŸ¹æŸ³ç‰›è‚‰æ±¤é¢.jpg', time: 30, ingredients: 'ä¸»é£Ÿåˆ›æ–°åšæ³•ï¼Œå…·ä½“å£å‘³ç°åœºæ­æ™“ï¼Œå¯èƒ½æœ‰æƒŠå–œ', tag: 'ğŸ†•æ–°å°è¯•' },
            { id: 27, category: 'staple', name: 'ğŸšç±³é¥­ç®¡é¥±ï¼ˆæ— é™ç»­ç¢—ï¼‰', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/è²è—•çŒªè‚‰é¥ºå­.jpg', time: 5, ingredients: 'äº”å¸¸å¤§ç±³ï¼Œç®¡å¤Ÿï¼Œé…åˆèœå“é£Ÿç”¨æ›´ä½³', tag: 'ğŸšå¿…ç‚¹' },
            // å‡‰èœ
            { id: 28, category: 'cold', name: 'ğŸ¥—å‡‰èœæ–°ä½œï¼ˆå†·ç›˜ç›²ç›’ï¼‰', image: 'https://raw.githubusercontent.com/ZYTsing/my-dishes/main/æ¸…ç‚’æ—¶è”¬.jpg', time: 20, ingredients: 'å½“å­£æ—¶è”¬åˆ›æ„æ­é…ï¼Œå…¨æ–°å£å‘³å°è¯•ï¼Œæ¸…çˆ½å¼€èƒƒ', tag: 'ğŸ†•æ–°å°è¯•' }
        ];

        // çŠ¶æ€ç®¡ç†
        let selectedDishes = JSON.parse(localStorage.getItem('selectedDishes')) || [];

        // åˆå§‹åŒ– EmailJS
        emailjs.init("S3liRsgn7Rt_hTHEM");

        // æ¸²æŸ“èœå“å¡ç‰‡
        function renderDishes() {
            const categories = ['hot', 'soup', 'staple', 'cold'];
            
            categories.forEach(category => {
                const container = document.getElementById(`${category}-dishes`);
                const categoryDishes = dishesData.filter(d => d.category === category);
                
                container.innerHTML = categoryDishes.map(dish => {
                    const isSelected = selectedDishes.includes(dish.id);
                    const hasBlindBox = dish.tag.includes('ğŸ†•');
                    const hasMustOrder = dish.tag.includes('ğŸš');
                    
                    return `
                        <div class="dish-card bg-white rounded-2xl overflow-hidden card-shadow cursor-pointer transition-all ${isSelected ? 'selected-card' : ''}" 
                             onclick="toggleDish(${dish.id})" data-dish-id="${dish.id}">
                            <div class="flex">
                                <div class="relative w-28 h-28 flex-shrink-0 overflow-hidden">
                                    <img src="${dish.image}" 
                                         alt="${dish.name}" 
                                         class="dish-image w-full h-full object-cover"
                                         loading="lazy"
                                         onerror="this.parentElement.innerHTML='<div class=\\'w-full h-full flex items-center justify-center bg-orange-50 text-4xl\\'>ğŸ½ï¸</div>'">
                                    ${hasBlindBox ? `
                                        <div class="absolute top-0 right-0 blind-box-badge text-white text-xs px-2 py-1 rounded-bl-lg font-bold">
                                            ç›²ç›’
                                        </div>
                                    ` : ''}
                                    ${hasMustOrder ? `
                                        <div class="absolute top-0 right-0 bg-green-500 text-white text-xs px-2 py-1 rounded-bl-lg font-bold">
                                            å¿…ç‚¹
                                        </div>
                                    ` : ''}
                                    ${isSelected ? `
                                        <div class="absolute inset-0 bg-orange-500 bg-opacity-20 flex items-center justify-center">
                                            <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center check-mark">
                                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="flex-1 p-3 flex flex-col justify-between">
                                    <div>
                                        <h3 class="font-bold text-gray-800 text-sm mb-1 line-clamp-1">${dish.name}</h3>
                                        <div class="flex items-center text-xs text-gray-500 mb-2">
                                            <svg class="w-3 h-3 mr-1 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            ${dish.time}åˆ†é’Ÿ
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <button onclick="event.stopPropagation(); toggleIngredients(${dish.id})" 
                                                class="text-xs text-orange-600 flex items-center hover:underline">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                            åŸæ–™æ¸…å•
                                        </button>
                                        ${dish.tag ? `<span class="text-xs text-orange-500 bg-orange-50 px-2 py-1 rounded-full">${dish.tag}</span>` : ''}
                                    </div>
                                </div>
                            </div>
                            <!-- åŸæ–™å±•å¼€åŒº -->
                            <div id="ingredients-${dish.id}" class="hidden border-t border-orange-100 bg-orange-50 px-3 py-2">
                                <p class="text-xs text-gray-600 leading-relaxed">${dish.ingredients}</p>
                            </div>
                        </div>
                    `;
                }).join('');
            });
        }

        // åˆ‡æ¢åŸæ–™å±•å¼€/æ”¶èµ·
        function toggleIngredients(dishId) {
            const el = document.getElementById(`ingredients-${dishId}`);
            el.classList.toggle('hidden');
        }

        // åˆ‡æ¢èœå“é€‰ä¸­çŠ¶æ€
        function toggleDish(dishId) {
            const index = selectedDishes.indexOf(dishId);
            if (index > -1) {
                selectedDishes.splice(index, 1);
            } else {
                selectedDishes.push(dishId);
            }
            saveToLocalStorage();
            renderDishes();
            updateFooter();
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocalStorage() {
            localStorage.setItem('selectedDishes', JSON.stringify(selectedDishes));
        }

        // æ›´æ–°åº•éƒ¨æ 
        function updateFooter() {
            const count = selectedDishes.length;
            const totalTime = selectedDishes.reduce((sum, id) => {
                const dish = dishesData.find(d => d.id === id);
                return sum + (dish ? dish.time : 0);
            }, 0);

            document.getElementById('count-text').textContent = count;
            document.getElementById('total-time').textContent = totalTime;
            
            const badge = document.getElementById('selected-count');
            if (count > 0) {
                badge.textContent = count;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        // æ»šåŠ¨åˆ°åˆ†ç±»
        function scrollToCategory(category) {
            // æ›´æ–°å¯¼èˆªæŒ‰é’®æ ·å¼
            document.querySelectorAll('.category-btn').forEach(btn => {
                if (btn.dataset.category === category) {
                    btn.classList.remove('text-orange-700', 'hover:bg-orange-100');
                    btn.classList.add('bg-orange-500', 'text-white');
                } else {
                    btn.classList.remove('bg-orange-500', 'text-white');
                    btn.classList.add('text-orange-700', 'hover:bg-orange-100');
                }
            });

            // æ»šåŠ¨åˆ°å¯¹åº”åŒºåŸŸ
            const element = document.getElementById(category);
            if (element) {
                const navHeight = document.querySelector('nav').offsetHeight;
                const headerHeight = document.querySelector('header').offsetHeight;
                const offset = navHeight + headerHeight;
                const elementPosition = element.getBoundingClientRect().top + window.pageYOffset - offset;
                window.scrollTo({ top: elementPosition, behavior: 'smooth' });
            }
        }

        // æ‰“å¼€æ¨¡æ€æ¡†
        function openModal() {
            if (selectedDishes.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©èœå“');
                return;
            }
            
            const modal = document.getElementById('modal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            renderModalContent();
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // æ¸²æŸ“æ¨¡æ€æ¡†å†…å®¹
        function renderModalContent() {
            const selectedDishData = selectedDishes.map(id => dishesData.find(d => d.id === id)).filter(Boolean);
            
            // æ¸²æŸ“å·²é€‰èœå“åˆ—è¡¨
            const dishesListEl = document.getElementById('modal-dishes-list');
            dishesListEl.innerHTML = selectedDishData.map(dish => `
                <div class="flex items-center justify-between bg-orange-50 rounded-lg px-3 py-2">
                    <div class="flex items-center">
                        <span class="text-sm text-gray-800">${dish.name}</span>
                        ${dish.tag ? `<span class="ml-2 text-xs text-orange-500">${dish.tag}</span>` : ''}
                    </div>
                    <span class="text-xs text-gray-500">${dish.time}min</span>
                </div>
            `).join('');

            // åˆå¹¶åŒç±»åŸæ–™
            const allIngredients = [];
            selectedDishData.forEach(dish => {
                if (dish.ingredients && !dish.ingredients.includes('ä¿å¯†') && !dish.ingredients.includes('æ­æ™“')) {
                    const parts = dish.ingredients.split('ã€');
                    parts.forEach(part => {
                        allIngredients.push(part.trim());
                    });
                }
            });

            // æ¸²æŸ“åŸæ–™åˆ—è¡¨
            const ingredientsListEl = document.getElementById('modal-ingredients-list');
            if (allIngredients.length > 0) {
                ingredientsListEl.innerHTML = allIngredients.map(ing => `
                    <span class="ingredient-tag text-xs text-gray-700 px-3 py-1.5 rounded-full">${ing}</span>
                `).join('');
            } else {
                ingredientsListEl.innerHTML = '<span class="text-xs text-gray-400">ç›²ç›’èœå“åŸæ–™ä¿å¯†ä¸­~</span>';
            }

            // æ›´æ–°æ€»æ—¶é—´
            const totalTime = selectedDishData.reduce((sum, d) => sum + d.time, 0);
            document.getElementById('modal-total-time').textContent = totalTime;
        }

        // å‘é€é‚®ä»¶
        function sendEmail() {
            const selectedDishData = selectedDishes.map(id => dishesData.find(d => d.id === id)).filter(Boolean);
            
            // æ ¼å¼åŒ–èœå“æ¸…å•
            const dishesText = selectedDishData.map(d => {
                const tagText = d.tag ? ` ${d.tag}` : '';
                return `- ${d.name}ï¼ˆ${d.time}minï¼‰${tagText}`;
            }).join('\n');

            // æ ¼å¼åŒ–åŸæ–™
            const allIngredients = [];
            selectedDishData.forEach(dish => {
                if (dish.ingredients && !dish.ingredients.includes('ä¿å¯†') && !dish.ingredients.includes('æ­æ™“')) {
                    const parts = dish.ingredients.split('ã€');
                    parts.forEach(part => {
                        allIngredients.push(part.trim());
                    });
                }
            });
            const ingredientsText = allIngredients.join('\n') || 'ç›²ç›’èœå“åŸæ–™ä¿å¯†ä¸­~';

            const totalTime = selectedDishData.reduce((sum, d) => sum + d.time, 0);
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN');

            const sendBtn = document.getElementById('send-btn');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<svg class="animate-spin w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>å‘é€ä¸­...';

            emailjs.send("my-dishes", "template_b6rjphj", {
                to_email: "415888875@qq.com",
                dishes: dishesText,
                ingredients: ingredientsText,
                time: `${totalTime}åˆ†é’Ÿ`,
                order_time: timeStr
            }).then(function(response) {
                showToast('å¤‡èœæ¸…å•å·²å‘é€è‡³415888875@qq.com');
                closeModal();
                sendBtn.disabled = false;
                sendBtn.innerHTML = `<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>å‘é€å¤‡èœæ¸…å•`;
            }, function(error) {
                showToast('å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                console.error('EmailJS Error:', error);
                sendBtn.disabled = false;
                sendBtn.innerHTML = `<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>å‘é€å¤‡èœæ¸…å•`;
            });
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 2500);
        }

        // ç›‘å¬æ»šåŠ¨æ›´æ–°å¯¼èˆª
        window.addEventListener('scroll', () => {
            const sections = ['hot', 'soup', 'staple', 'cold'];
            const navHeight = document.querySelector('nav').offsetHeight;
            const headerHeight = document.querySelector('header').offsetHeight;
            const offset = navHeight + headerHeight + 20;
            
            let currentCategory = 'hot';
            sections.forEach(category => {
                const element = document.getElementById(category);
                if (element) {
                    const rect = element.getBoundingClientRect();
                    if (rect.top <= offset) {
                        currentCategory = category;
                    }
                }
            });

            document.querySelectorAll('.category-btn').forEach(btn => {
                if (btn.dataset.category === currentCategory) {
                    btn.classList.remove('text-orange-700', 'hover:bg-orange-100');
                    btn.classList.add('bg-orange-500', 'text-white');
                } else {
                    btn.classList.remove('bg-orange-500', 'text-white');
                    btn.classList.add('text-orange-700', 'hover:bg-orange-100');
                }
            });
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') {
                closeModal();
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderDishes();
            updateFooter();
        });
    </script>
</body>
</html>
